- name: generate CA & kubeconfig
  hosts: deployer
  roles:
    - initial-setup

- name: Setup etcd cluster
  hosts: etcd
  roles:
    - etcd-cluster

- name: Setup Master Cluter
  hosts: master
  roles:
    - haproxy-keepalived
    - master-cluster

- name: Setup Worker
  hosts: worker,master
  roles:
    - worker-cluster

- name: Setup CNI & core-dns
  hosts: master
  roles:
    - cni-dns

#############################
##### Renew Certificate #####
#############################
#
# run this roles if certificate is expired
# dont forget to comment all other roles
#

#- name: renew Certificate
#  hosts: deployer
#  roles:
#    - renew-certificate

#
# restarting service kubernetes etcd
# systemctl restart etcd
#
# restarting service kubernetes master
# systemctl restart kube-apiserver
# systemctl restart kube-scheduler
# systemctl restart kube-controller-manager
# systemctl restart kubelet
# systemctl restart kube-proxy
#
# restarting service kubernetes worker
# systemctl restart kubelet
# systemctl restart kube-proxy
#



